<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Learnify Sandbox</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family:Arial;
  background:#0b0b12;
  color:white;
  display:flex;
  justify-content:center;
  padding:20px;
}

.container{
  display:flex;
  gap:40px;
  flex-wrap:wrap;
}

.panel{
  border:2px solid #00f7ff;
  border-radius:16px;
  padding:20px;
  min-width:320px;
  box-shadow:0 0 12px #00f7ff;
  transition:0.3s;
}

.flash{
  box-shadow:0 0 30px #00ffcc;
}

button{
  margin:6px;
  padding:10px 18px;
  border-radius:12px;
  border:2px solid #00f7ff;
  background:#05050a;
  color:#00f7ff;
  cursor:pointer;
}

button:hover{
  transform:scale(1.05);
}

button.archive{
  border-color:#ff004c;
  color:#ff004c;
}

input{
  margin:4px;
  padding:6px;
  width:90%;
}
</style>
</head>

<body>

<div class="container">

<!-- CREATE PANEL -->
<div class="panel" id="createPanel">
<h3>Create Quiz</h3>

<input id="question" placeholder="Question"><br>
<input id="a1" placeholder="Answer 1">
<input id="a2" placeholder="Answer 2">
<input id="a3" placeholder="Answer 3">
<input id="a4" placeholder="Answer 4"><br>
<input id="correct" type="number" placeholder="Correct (1-4)" min="1" max="4"><br>

<button onclick="addQuestion()">Add Question</button>
<button onclick="saveQuiz()">Save Quiz</button>
<button onclick="showMyQuizzes()">My Quizzes</button>
<button onclick="resetEverything()">Reset</button>

<ul id="questionList"></ul>
</div>

<!-- MY QUIZZES PANEL -->
<div class="panel" id="myQuizPanel" style="display:none;">
<h3>My Quizzes</h3>
<ul id="quizList"></ul>

<button onclick="deleteQuiz()" class="archive">Delete Quiz</button>
<button onclick="backToCreate()">Back</button>
</div>

<!-- MULTIPLAYER PANEL -->
<div class="panel" id="multiPanel">
<h3>Multiplayer Lobby</h3>
<p id="lobbyStatus">Status: No Active Game</p>

<div id="lobbyView">
<button onclick="hostGame()">Host Game</button><br>
<button onclick="joinGame()">Join Game</button><br>
<button onclick="showPlayers()">Players Joined</button><br>
<button onclick="startGame()">Start Game</button><br>
<button onclick="backToLobby()">Back to Lobby</button>
</div>

<div id="gameView" style="display:none;">
<h3 id="gameQuestion"></h3>
<div id="answers"></div>
<p id="scoreDisplay"></p>
<button onclick="backToLobby()" class="archive">Exit Game</button>
</div>

</div>

</div>

<script>
let questions = [];
let lobby = null;
let currentQuestionIndex = 0;
let score = 0;

/* CREATE QUIZ */

function addQuestion(){
  const q = question.value.trim();
  const answers = [a1.value,a2.value,a3.value,a4.value];
  const correctIndex = parseInt(correct.value)-1;

  if(!q || answers.includes("") || correctIndex<0 || correctIndex>3){
    alert("Fill everything correctly!");
    return;
  }

  questions.push({q,answers,correct:correctIndex});
  updateQuestionList();

  question.value="";
  a1.value="";
  a2.value="";
  a3.value="";
  a4.value="";
  correct.value="";
}

function updateQuestionList(){
  questionList.innerHTML="";
  questions.forEach((q,i)=>{
    const li=document.createElement("li");
    li.textContent=(i+1)+". "+q.q;
    questionList.appendChild(li);
  });
}

function saveQuiz(){
  if(questions.length===0){ alert("No questions!"); return; }

  let saved = JSON.parse(localStorage.getItem("myQuizzes")||"{}");
  const name = prompt("Quiz name:");
  if(!name) return;

  saved[name]=questions;
  localStorage.setItem("myQuizzes",JSON.stringify(saved));
  alert("Saved!");
}

/* MY QUIZZES */

function showMyQuizzes(){
  createPanel.style.display="none";
  myQuizPanel.style.display="block";
  renderQuizzes();
}

function backToCreate(){
  createPanel.style.display="block";
  myQuizPanel.style.display="none";
}

function renderQuizzes(){
  quizList.innerHTML="";
  let saved = JSON.parse(localStorage.getItem("myQuizzes")||"{}");

  if(Object.keys(saved).length===0){
    quizList.innerHTML="<li>No quizzes saved</li>";
    return;
  }

  for(let name in saved){
    let li=document.createElement("li");
    li.textContent=name;
    li.onclick=()=>{
      questions=saved[name];
      updateQuestionList();
      alert("Loaded "+name);
    };
    quizList.appendChild(li);
  }
}

function deleteQuiz(){
  let saved = JSON.parse(localStorage.getItem("myQuizzes")||"{}");
  const name = prompt("Enter quiz name to delete:");
  if(saved[name]){
    delete saved[name];
    localStorage.setItem("myQuizzes",JSON.stringify(saved));
    renderQuizzes();
    alert("Deleted!");
  } else {
    alert("Quiz not found.");
  }
}

/* MULTIPLAYER */

function hostGame(){
  if(questions.length===0){ alert("Create a quiz first!"); return; }
  lobby={players:["Host"]};
  lobbyStatus.textContent="Status: Game Hosted";
}

function joinGame(){
  if(!lobby){ alert("No active game!"); return; }
  const name=prompt("Player name:");
  if(!name) return;
  lobby.players.push(name);
}

function showPlayers(){
  if(!lobby){ alert("No active game!"); return; }
  alert(lobby.players.join("\n"));
}

/* GAME */

function startGame(){
  if(!lobby){ alert("Host first!"); return; }

  currentQuestionIndex=0;
  score=0;

  lobbyView.style.display="none";
  gameView.style.display="block";
  lobbyStatus.textContent="Status: In Game";

  showQuestion();
}

function showQuestion(){

  if(currentQuestionIndex>=questions.length){
    gameQuestion.textContent="Game Over!";
    answers.innerHTML="";
    scoreDisplay.textContent="Final Score: "+score;
    return;
  }

  let q=questions[currentQuestionIndex];

  gameQuestion.textContent=q.q;
  answers.innerHTML="";
  scoreDisplay.textContent="Score: "+score;

  q.answers.forEach((ans,i)=>{
    let btn=document.createElement("button");
    btn.textContent=ans;
    btn.onclick=()=>{
      if(i===q.correct) score++;
      currentQuestionIndex++;
      showQuestion();
    };
    answers.appendChild(btn);
  });
}

/* BACK TO LOBBY */

function backToLobby(){

  // Always force lobby view
  lobbyView.style.display="block";
  gameView.style.display="none";

  // Reset game state
  currentQuestionIndex=0;
  score=0;
  gameQuestion.textContent="";
  answers.innerHTML="";
  scoreDisplay.textContent="";

  lobby=null;
  lobbyStatus.textContent="Status: No Active Game";

  // Visual flash so you SEE it worked
  multiPanel.classList.add("flash");
  setTimeout(()=>{
    multiPanel.classList.remove("flash");
  },300);
}

/* RESET */

function resetEverything(){
  questions=[];
  lobby=null;
  updateQuestionList();
  backToLobby();
}
</script>

</body>
</html>
