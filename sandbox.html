<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Learnify Multiplayer Sandbox</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial;
  background: #0b0b12;
  color: white;
  text-align: center;
  margin-top: 30px;
}
button {
  padding: 14px 30px;
  margin: 10px;
  font-size: 18px;
  border-radius: 14px;
  border: 2px solid #00f7ff;
  background: #05050a;
  color: #00f7ff;
  cursor: pointer;
  box-shadow: 0 0 8px #00f7ff, 0 0 16px #00f7ff;
}
button:hover { transform: scale(1.05); }
.answer { width: 80%; max-width: 400px; }
.hidden { display: none; }
.code { font-size: 2em; letter-spacing: 6px; color: #00f7ff; }
</style>
</head>

<body>

<h1>Learnify Multiplayer</h1>

<!-- HOME -->
<div id="home">
  <button id="host-btn">Host Game</button><br><br>
  <input id="name-input" placeholder="Your name"><br>
  <input id="code-input" placeholder="Game code"><br>
  <button id="join-btn">Join Game</button>
</div>

<!-- HOST -->
<div id="host" class="hidden">
  <h2>Game Code</h2>
  <div class="code" id="host-code"></div>
  <h3 id="host-question">Waiting to start…</h3>
  <button id="start-btn">Start Game</button>
  <button id="next-btn" class="hidden">Next Question</button>
  <button id="host-back-btn">Back to Main Lobby</button>
</div>

<!-- PLAYER -->
<div id="player" class="hidden">
  <h2 id="player-question">Waiting for host…</h2>
  <div id="answers"></div>
  <button id="player-back-btn">Back to Main Lobby</button>
</div>

<!-- LEADERBOARD -->
<div id="leaderboard" class="hidden">
  <h2>Leaderboard</h2>
  <div id="scores"></div>
</div>

<script>
const KEY = "learnify_sandbox_game";

/* UTILS */
function save(data){ localStorage.setItem(KEY, JSON.stringify(data)); }
function load(){ return JSON.parse(localStorage.getItem(KEY) || "null"); }

const home = document.getElementById("home");
const host = document.getElementById("host");
const player = document.getElementById("player");
const leaderboard = document.getElementById("leaderboard");

const hostQ = document.getElementById("host-question");
const playerQ = document.getElementById("player-question");
const answersDiv = document.getElementById("answers");
const scoresDiv = document.getElementById("scores");

let myName = "";
let answered = false;

/* HOST BUTTON */
document.getElementById("host-btn").onclick = () => {
  const quizzes = JSON.parse(localStorage.getItem("myQuizzes") || "{}");
  const names = Object.keys(quizzes);

  if(names.length === 0){
    alert("You must save a quiz in Create Quiz before hosting.");
    return;
  }

  const quizName = names[0];
  const game = {
    code: Math.floor(100000 + Math.random()*900000),
    quiz: quizzes[quizName],
    index: -1,
    players: {}
  };

  save(game);
  home.classList.add("hidden");
  host.classList.remove("hidden");
  document.getElementById("host-code").textContent = game.code;
};

/* JOIN BUTTON */
document.getElementById("join-btn").onclick = () => {
  myName = document.getElementById("name-input").value.trim();
  const code = document.getElementById("code-input").value.trim();
  const game = load();

  if(!myName || !game || game.code != code){
    alert("Invalid name or code");
    return;
  }

  if(!game.players[myName]) game.players[myName] = 0;
  save(game);

  home.classList.add("hidden");
  player.classList.remove("hidden");
};

/* START GAME */
document.getElementById("start-btn").onclick = () => {
  const game = load();
  game.index = 0;
  save(game);
  document.getElementById("start-btn").classList.add("hidden");
  document.getElementById("next-btn").classList.remove("hidden");
};

/* NEXT QUESTION */
document.getElementById("next-btn").onclick = () => {
  const game = load();
  game.index++;
  answered = false;
  if(game.index >= game.quiz.length){
    leaderboard.classList.remove("hidden");
    host.classList.add("hidden");
    player.classList.add("hidden");
  }
  save(game);
};

/* BACK BUTTONS */
document.getElementById("host-back-btn").onclick = () => {
  localStorage.removeItem(KEY);
  location.reload();
};
document.getElementById("player-back-btn").onclick = () => {
  location.reload();
};

/* SYNC LOOP */
setInterval(() => {
  const game = load();
  if(!game || game.index < 0) return;

  const q = game.quiz[game.index];
  if(!q) return;

  hostQ.textContent = q.q;
  playerQ.textContent = q.q;

  // Player answers
  if(!answered && !player.classList.contains("hidden")){
    answersDiv.innerHTML = "";
    q.answers.forEach((a,i)=>{
      const btn = document.createElement("button");
      btn.textContent = a;
      btn.className = "answer";
      btn.onclick = () => {
        answered = true;
        if(i === q.correct){
          const g = load();
          g.players[myName] += 100;
          save(g);
        }
      };
      answersDiv.appendChild(btn);
    });
  }

  // Leaderboard
  scoresDiv.innerHTML = "";
  Object.entries(game.players)
    .sort((a,b)=>b[1]-a[1])
    .forEach(p=>{
      const d=document.createElement("div");
      d.textContent=`${p[0]} — ${p[1]} pts`;
      scoresDiv.appendChild(d);
    });
}, 500);
</script>

</body>
</html>
